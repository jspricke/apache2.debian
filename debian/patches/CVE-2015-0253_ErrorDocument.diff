#commit 9a6f9bcf9594bc946d23b9a27e3510488e9f94a9
#Author: Eric Covener <covener@apache.org>
#Date:   Tue Mar 24 13:08:44 2015 +0000
#
#    Merge r1664205 from trunk:
#    
#      *) SECURITY: CVE-2015-0253 (cve.mitre.org)
#         core: Fix a crash introduced in with ErrorDocument 400 pointing
#         to a local URL-path with the INCLUDES filter active, introduced
#         in 2.4.11. PR 57531. [Yann Ylavic]
#    
#    
#    Submitted By: ylavic
#    Committed By: covener
#    
#    
#    
#    
#    
#    
#    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/branches/2.4.x@1668879 13f79535-47bb-0310-9956-ffa450edef68
#
--- apache2.orig/server/protocol.c
+++ apache2/server/protocol.c
@@ -599,8 +599,6 @@ static int read_request_line(request_rec
              */
             if (APR_STATUS_IS_ENOSPC(rv)) {
                 r->status    = HTTP_REQUEST_URI_TOO_LARGE;
-                r->proto_num = HTTP_VERSION(1,0);
-                r->protocol  = apr_pstrdup(r->pool, "HTTP/1.0");
             }
             else if (APR_STATUS_IS_TIMEUP(rv)) {
                 r->status = HTTP_REQUEST_TIME_OUT;
@@ -608,6 +606,8 @@ static int read_request_line(request_rec
             else if (APR_STATUS_IS_EINVAL(rv)) {
                 r->status = HTTP_BAD_REQUEST;
             }
+            r->proto_num = HTTP_VERSION(1,0);
+            r->protocol  = apr_pstrdup(r->pool, "HTTP/1.0");
             return 0;
         }
     } while ((len <= 0) && (++num_blank_lines < max_blank_lines));
