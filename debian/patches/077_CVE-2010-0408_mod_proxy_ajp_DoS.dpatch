#! /bin/sh /usr/share/dpatch/dpatch-run
## 077_CVE-2010-0408_mod_proxy_ajp_DoS.dpatch
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: http://svn.apache.org/viewvc?rev=917876&amp;view=rev

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' lenny-apache2~/modules/proxy/mod_proxy_ajp.c lenny-apache2/modules/proxy/mod_proxy_ajp.c
--- a/modules/proxy/mod_proxy_ajp.c
+++ a/modules/proxy/mod_proxy_ajp.c
@@ -231,7 +231,7 @@
             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: ap_get_brigade failed");
             apr_brigade_destroy(input_brigade);
-            return HTTP_INTERNAL_SERVER_ERROR;
+            return HTTP_BAD_REQUEST;
         }
 
         /* have something */
