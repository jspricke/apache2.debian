#! /bin/sh /usr/share/dpatch/dpatch-run
# Description: fix denial of service via crafted request in mod_proxy_ajp
# Origin: upstream, http://svn.apache.org/viewvc?view=revision&revision=917876

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' apache2~/modules/proxy/mod_proxy_ajp.c apache2/modules/proxy/mod_proxy_ajp.c
--- apache2~/modules/proxy/mod_proxy_ajp.c	2008-06-05 14:46:43.000000000 +0200
+++ apache2/modules/proxy/mod_proxy_ajp.c	2010-03-28 17:48:17.000000000 +0200
@@ -231,7 +231,7 @@
             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: ap_get_brigade failed");
             apr_brigade_destroy(input_brigade);
-            return HTTP_INTERNAL_SERVER_ERROR;
+            return HTTP_BAD_REQUEST;
         }
 
         /* have something */
