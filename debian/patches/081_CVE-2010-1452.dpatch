#! /bin/sh /usr/share/dpatch/dpatch-run
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: http://svn.apache.org/viewvc/httpd/httpd/branches/2.2.x/modules/dav/main/util.c?r1=966349&r2=966348&pathrev=966349&view=patch

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' lenny-apache2~/modules/dav/main/util.c lenny-apache2/modules/dav/main/util.c
--- lenny-apache2~/modules/dav/main/util.c	2008-01-05 10:45:07.000000000 +0100
+++ lenny-apache2/modules/dav/main/util.c	2011-08-29 21:00:20.653445523 +0200
@@ -624,7 +624,8 @@
 
             /* 2518 specifies this must be an absolute URI; just take the
              * relative part for later comparison against r->uri */
-            if (apr_uri_parse(r->pool, uri, &parsed_uri) != APR_SUCCESS) {
+            if (apr_uri_parse(r->pool, uri, &parsed_uri) != APR_SUCCESS
+                || !parsed_uri.path) {
                 return dav_new_error(r->pool, HTTP_BAD_REQUEST,
                                      DAV_ERR_IF_TAGGED,
                                      "Invalid URI in tagged If-header.");
